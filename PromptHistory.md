# プロンプト履歴

## ReadMe生成時のプロンプト

```
主にC#を使用して、目的を実現するソフトを作ります。まずはReadMe.mdへ、作成するソフトの仕様をMarkdownを使用して書いてください。図が必要な場合は、PlantUMLで書いてください。

# 目的

まず、ソフトはRAGのデータソースを作成する機能を持ちます。複数のMarkdownファイルを含むSphinxプロジェクトがあります。これをRAGのデータソースとして使用できるように、適切にチャンク分割とベクトル化を行って、ベクトルDBへ保存します。ベクトルDBはWindowsOS（クライアントOS）のローカルに保存する必要があります。ソフトはローカルで完結する必要があり、チャンク分割とベクトル化にはSewmantic Kernelとローカルで動作可能な軽量モデルを使用します。

次に、ソフトはコンソールアプリとしてCUIを持ち、テキストチャットでLLMと会話することを可能とします。LLMとの会話をする際に、すでに保存したベクトルDBの内容を類似検索し、それをLLMへのコンテキスト情報へ付加します。つまり、いわゆるRAGとして使用します。このLLMとの会話も、ローカルで動作可能な軽量モデルを使用します。

コンソールアプリは、GenericHostを使用して作成します。C#は、.NET 9を使用します。

このようなソフトウェアをWindows上で動作するように作成しますが、開発者のスキルはC#がメインのため、出来るだけPythonなどの他の言語を使わずに、主にC#で作成します。C#以外の言語を使う場合、まずC++を優先して使用します。
```

## ソースコード生成時のプロンプト

1. ReadMe.mdに書かれた仕様書に従って、プロジェクトやソースコードを作成してください。必要なライブラリがある場合、NuGetで取得してください。テストコードを書くことが効果的だと判断できる部分があれば、NUnitのテストプロジェクトを作成してソースコードを書いてください。
1. 埋め込み生成の処理を書いてください。ベクトルDBとしてはSharpVectorを使用し、埋め込み生成の処理はSemanticKernelを通してintfloat/multilingual-e5-baseモデルを使用するようにしてください。
1. intfloat/multilingual-e5-baseは、ONNX形式でダウンロードしたものを使用します。ローカルからファイルを読み込むようにしてください。
1. ベクトルデータベースのSharpVectorとは、SharpVectorsではなく、Build5Nines.SharpVectorを使用します。これを使用して、ベクトルDBの読み書きも実装してください。
1. E5用トークナイザを、Microsoft.ML.Tokenizersを使用して実装してください。
1. ベクトルデータベースを、pgvector-dotnetに変更します。これを使用して、ベクトルDBの読み書き処理を書き直してください。
1. ILlmServiceの実装を、ONNX形式でダウンロードした軽量モデルを使用してチャットを行う形で実装してください。
1. コンソールアプリの実行時引数に、「/CreateDataSource <フォルダパス>」のように指定した場合にだけ、RAGデータソース構築を行うようにしてください。<フォルダパス>は、Markdownファイルが含まれているフォルダのパスです。引数が無い場合は、チャットモードで動作します。以上の内容を、ReadMe.mdの仕様書に追記し、ソースコードも実装してください。
1. チャットを行うLLMとの会話部分について、モデルはPhi-3-mini-4k-instructを使用し、Microsoft.ML.OnnxRuntimeGenAIを使って実装してください。この処理の中に、仕様書にある次の処理も実装してください。「入力文に対し、ベクトルDBから類似チャンクを検索し、LLMへのプロンプトに付加（RAG動作）」
1. LlmSessionというクラスが存在せず、コンパイルエラーとなっています。その型が使われている_llmSession.GenerateAsync()の部分には、トークナイザーの使用やGeneratorの設定や推論処理そのものが欠けているように見えるため、おそらく_llmSession.GenerateAsync()の部分を追加実装する必要があります。そうした作業を行ってください。
1. DataSourceComponents.csは、あまり相互に依存の無い多数のクラスを全て持ってしまっているのに、フォルダ内にはそのファイルしか入っていません。ソリューションの見通しが悪いため、クラスごとに1つのファイルとし、ファイル名はクラス名と同じものに変えてください。
